<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <style>body{margin:0;overflow:hidden;background:#222;}canvas{width:100vw;height:100vh;}</style>
</head>
<body>
<script>
const scene=new THREE.Scene(),camera=new THREE.PerspectiveCamera(45,innerWidth/innerHeight,0.1,1000);
camera.position.z=3;const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);document.body.appendChild(renderer.domElement);
scene.add(new THREE.AmbientLight(0xffffff,1));

// 2D AVATAR
const canvas=document.createElement('canvas');canvas.width=canvas.height=512;
const ctx=canvas.getContext('2d'),texture=new THREE.CanvasTexture(canvas),
sprite=new THREE.Sprite(new THREE.SpriteMaterial({map:texture}));
sprite.scale.set(2,2,1);scene.add(sprite);let mouthHeight=30;let isTalking=false;

function drawFace(){
    ctx.fillStyle='#f4c4f3';ctx.beginPath();ctx.arc(256,256,200,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#fff';ctx.fillRect(140,180,60,60);ctx.fillRect(312,180,60,60);
    ctx.fillStyle='#333';ctx.fillRect(155,195,30,30);ctx.fillRect(327,195,30,30);
    ctx.fillRect(200,280,112,mouthHeight);texture.needsUpdate=true;
}

// FLUTTERFLOW READY
window.startTalking=(text)=>{
    isTalking=true;
    const utter=new SpeechSynthesisUtterance(text);
    utter.onend=()=>isTalking=false;
    speechSynthesis.speak(utter);
};

function animate(){
    requestAnimationFrame(animate);
    if(isTalking) mouthHeight=30+Math.sin(Date.now()*0.02)*40;
    else mouthHeight=30;
    drawFace();renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
